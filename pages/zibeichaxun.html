<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>字辈聚集地查询</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/custom.css">
  <style>
    .search-box{display:flex;flex-direction:column;align-items:flex-start;gap:0;margin-bottom:20px}
    .search-box input[type=text]{width:240px;padding:6px}
    .search-box button{width:240px;padding:8px;margin-top:8px}
    .spacer{height:1.2em}
  </style>
</head>
<body>
  <h1>字辈聚集地查询</h1>
  <p class="note">请输入关键字（可多个汉字连续输入）。</p>

  <div class="search-box">
    <input type="text" id="key1" placeholder="请输入关键字">
    <div class="spacer"></div>
    <button id="strictBtn">精准查询</button>
    <button id="fuzzyBtn">模糊查询</button>
  </div>

  <div id="result"></div>

  <script src="../js/zibeichaxun.js"></script>
  <script>
  (()=>{
    const strictBtn = document.getElementById('strictBtn');
    const fuzzyBtn  = document.getElementById('fuzzyBtn');
    const input     = document.getElementById('key1');
    const result    = document.getElementById('result');

    const doQuery = async (strict = false) => {
      const kw = input.value.trim();
      if (!kw) return alert('请至少输入一个关键字！');
      result.textContent = '查询中...';
      try {
        const res = await fetch('../data/zibeiyugaikuang.json?v=' + Date.now());
        if (!res.ok) throw new Error('网络错误 ' + res.status);
        const data = await res.json();

        const hit = strict ? Zibeichaxun.queryStrict(data, kw)
                           : Zibeichaxun.query(data, kw);

        if (!hit.length) return (result.innerHTML = '<p>查不到相关数据</p>');

        const countHtml = `<p style="margin:4px 0;color:#555;">共查到 <strong>${hit.length}</strong> 条记录</p>`;
        const kwArr = kw.split(/\s+/);
        const highlight = arr => arr.map(ch =>
          kwArr.includes(ch) ? `<span class="highlight-key">${ch}</span>` : ch
        );

        let html = countHtml + '<table border="1" cellpadding="6"><tr><th>ID</th><th>聚集地</th><th>字辈与概况</th></tr>';
        hit.forEach(({ ID, 聚集地, 字辈 }) => {
          const highlighted = highlight(字辈).join('，');
          html += `<tr><td>${ID}</td><td>${聚集地}</td><td>${highlighted}</td></tr>`;
        });
        result.innerHTML = html + '</table>';
      } catch (e) {
        result.innerHTML = `<p style="color:red;">查询出错：${e.message}</p>`;
      }
    };

    strictBtn.addEventListener('click', () => doQuery(true));
    fuzzyBtn.addEventListener('click', () => doQuery(false));
    input.addEventListener('keyup', e => { if (e.key === 'Enter') fuzzyBtn.click(); });
  })();
  </script>
</body>
</html>